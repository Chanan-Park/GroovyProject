<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chanan">
	
	<!-- 팀 문서함 게시글 수 조회 -->
	<select id="getTeamDraftCnt" resultType="int" parameterType="com.spring.groovy.common.Pagination" >
		SELECT COUNT(*) FROM VIEW_TEAM_DRAFT
		<if test='searchType != "" and searchWord != "" '>
		WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		</if>
	</select>
	
	<!-- 팀 문서함 목록 조회 -->
	<select id="getTeamDraftList" resultType="com.spring.groovy.approval.model.DraftVO" parameterType="HashMap" >
		SELECT * 
		FROM ( SELECT A.*, ROWNUM AS RNO
		    FROM ( SELECT *
		            FROM
		            VIEW_TEAM_DRAFT
		            <if test='searchType != "" and searchWord != "" '>
		            WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		            </if>
					ORDER BY ${sortType} ${sortOrder}
		            )A )
		WHERE RNO BETWEEN #{startRno} AND #{endRno}
		and DEPARTMENT = #{department}
	</select>
		
	<!-- 개인 문서함-상신함 게시글 수 조회 -->
	<select id="getSentDraftCnt" resultType="int" parameterType="com.spring.groovy.common.Pagination" >
		SELECT COUNT(*) FROM VIEW_MY_DRAFT_SENT
		<if test='searchType != "" and searchWord != "" '>
		WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		</if>
	</select>
	
	<!-- 개인문서함-상신함 목록 조회 -->
	<select id="getSentDraftList" resultType="com.spring.groovy.approval.model.DraftVO" parameterType="HashMap" >
		SELECT * 
		FROM ( SELECT A.*, ROWNUM AS RNO
		    FROM ( SELECT *
		            FROM
		            VIEW_MY_DRAFT_SENT
		            <if test='searchType != "" and searchWord != "" '>
		            WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		            </if>
		            ORDER BY ${sortType} ${sortOrder}
		            )A )
		WHERE RNO BETWEEN #{startRno} AND #{endRno}
		and FK_DRAFT_EMPNO = #{empno}
	</select>
		
	<!-- 개인 문서함-결재함 게시글 수 조회 -->
	<select id="getProcessedDraftCnt" resultType="int" parameterType="com.spring.groovy.common.Pagination" >
		SELECT COUNT(*) FROM VIEW_MY_DRAFT_PROCESSED
		<if test='searchType != "" and searchWord != "" '>
		WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		</if>
	</select>
	
	<!-- 개인문서함-결재함 목록 조회 -->
	<select id="getProcessedDraftList" resultType="com.spring.groovy.approval.model.DraftVO" parameterType="HashMap" >
		SELECT * 
		FROM ( SELECT A.*, ROWNUM AS RNO
		    FROM ( SELECT *
		            FROM
		            VIEW_MY_DRAFT_PROCESSED
		            <if test='searchType != "" and searchWord != "" '>
		            WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		            </if>
		            ORDER BY ${sortType} ${sortOrder}
		            )A )
		WHERE RNO BETWEEN #{startRno} AND #{endRno}
		and FK_APPROVAL_EMPNO = #{empno}
	</select>
		
	<!-- 개인 문서함-임시저장함 게시글 수 조회 -->
	<select id="getSavedDraftCnt" resultType="int" parameterType="com.spring.groovy.common.Pagination" >
		SELECT COUNT(*) FROM VIEW_MY_DRAFT_SAVED
		<if test='searchType != "" and searchWord != "" '>
		WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		</if>
	</select>
	
	<!-- 개인문서함-임시저장함 목록 조회 -->
	<select id="getSavedDraftList" resultType="com.spring.groovy.approval.model.DraftVO" parameterType="HashMap" >
		SELECT * 
		FROM ( SELECT A.*, ROWNUM AS RNO
		    FROM ( SELECT *
		            FROM
		            VIEW_MY_DRAFT_SAVED
		            <if test='searchType != "" and searchWord != "" '>
		            WHERE LOWER(${searchType}) LIKE '%'||LOWER(#{searchWord})||'%'
		            </if>
		            ORDER BY ${sortType} ${sortOrder}
		            )A )
		WHERE RNO BETWEEN #{startRno} AND #{endRno}
		and FK_DRAFT_EMPNO = #{empno}
	</select>
	
	<!-- 개인문서함-임시저장함 글 삭제 -->
	<delete id="deleteDraftList" parameterType="map">
		delete from tbl_draft
		where draft_seq in
		<foreach collection="array" item="seq" open="(" close=")" separator=",">
				#{seq}
		</foreach>
	</delete>
	
</mapper>